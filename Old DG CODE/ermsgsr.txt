ERMSG.SR

        .ENT ERMSG

;
;
;
;
;

	AC0=0
	AC1=1
	AC2=2
	AC3=3

	FPAC0=0
	FPAC1=1
	FPAC2=2
	FPAC3=3


        .NREL   1
 ; SUBPROGRAMS  STARTS HERE
START:
	.EJEC

;THIS SUBROUTINE WILL RETRIEVE THE SYTEM ERROR MESSAGE
; PARAMETER TABLE

.ERWN = -12.                    ;BECOMES BYTE ADDRESS OF ERRWRD
.ERWL = 6B10+3                  ;CIS PIC 9(9) COMP

.EEMN =  -14.                    ; BECOMES BYTE ADDRESS OF MESSAGE
.EEML = 80.                     ; 80 BYTES LONG

.RERN = -16.			;RETURN WORD


ERMSG:	WSAVS	0		;SAVE ALL
;BLANK OUT ERROR
	WLDAI	" ,AC1		;GET A BLANK
	LWLDA	AC3,.EEMN,AC3	;GET BYTE ADDRESS OF MSG
	WSTB	AC3,AC1		;PUT IN FIRST ' '
	WMOV	AC3,AC2		;LOAD DESTINATION AC
	WINC	AC2,AC2		;NEXT BYTE
	WLDAI	.EEML,AC0	;LENGTH OF MOVE
	WMOV	AC0,AC1		;LENGTH OF MOVE
	WCMV			;BLANK OUT

	XWLDA	AC1,MASK1	;GET MASK WITH CHANNEL
	LDAFP	AC3		;RESTORE FP
	LWLDA	AC2,.ERWN,AC3	;GET ERROR BYTE ADDR
	WLSHI	-1,AC2		;WORD ADDRESS
	LWLDA	AC2,0,AC2	;GET ERROR
	WMOV	AC2,AC0
	LWLDA	AC2,.EEMN,AC3	;BYTE POINTER TO MSG
	?ERMSG
	WBR	ERROR
  	LDAFP	AC3		;RESTORE FRAME POINTER
	WSUB 	AC0,AC0
	LWLDA	AC2,.RERN,AC3	;GET BYTE POINTER TO ERROR
	WLSHI	-1,AC2		;WORD POINTER
	LWSTA	AC0,0,AC2	;SET NO ERROR
	WRTN
ERROR:	
	LDAFP	AC3
	LWLDA	AC2,.RERN,AC3	;GET BYTE POINTER TO ERROR
	WLSHI	-1,AC2		;WORD POINTER
	LWSTA	AC0,0,AC2	;SET NO ERROR
	WRTN
MASK1:	.DWORD	80.*400+377	;THIS WILL GET ERROR FROM SYSTEM

	.NREL

	.END
